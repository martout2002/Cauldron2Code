# Deployment Quick Reference Guide

## üéØ At a Glance

| What | Where | Status |
|------|-------|--------|
| **UI Selection** | `/configure` page ‚Üí Deployment Targets section | ‚úÖ Working |
| **Vercel Config** | `vercel.json` | ‚úÖ Generated |
| **Railway Config** | `railway.json` | ‚úÖ Generated |
| **Render Config** | `render.yaml` | ‚úÖ Generated |
| **EC2 Scripts** | `deploy/*.sh`, `deploy/*.conf` | ‚úÖ Generated |
| **Docker Files** | `Dockerfile`, `docker-compose.yml` | ‚úÖ Generated (if enabled) |
| **Documentation** | `DEPLOYMENT.md` | ‚úÖ Generated |
| **Health Checks** | Express: ‚úÖ / Next.js: ‚ùå | ‚ö†Ô∏è Partial |

## üìÅ Files Generated by Platform

### Vercel
```
vercel.json                          # Build & env config
.github/workflows/ci.yml             # Auto-deploy (if GitHub Actions enabled)
```

### Railway
```
railway.json                         # Build & deploy config
```

### Render
```
render.yaml                          # Blueprint config with services
```

### EC2
```
deploy/
‚îú‚îÄ‚îÄ setup.sh                         # Initial server setup
‚îú‚îÄ‚îÄ deploy.sh                        # App deployment
‚îú‚îÄ‚îÄ nginx.conf                       # Reverse proxy config
‚îî‚îÄ‚îÄ ${projectName}.service           # Systemd service
```

### Docker (Optional)
```
Dockerfile                           # Multi-stage build
docker-compose.yml                   # Local dev setup
.dockerignore                        # Security
```

## üöÄ Deployment Commands

### Vercel
```bash
# Manual deploy
npm install -g vercel
vercel

# Production deploy
vercel --prod

# Auto-deploy: Push to main branch (if GitHub Actions enabled)
```

### Railway
```bash
# Manual deploy
npm install -g @railway/cli
railway login
railway up

# Auto-deploy: Push to main branch (native integration)
```

### Render
```bash
# No CLI - use web dashboard
# Auto-deploy: Push to main branch (native integration)
```

### EC2
```bash
# Initial setup
ssh -i key.pem ubuntu@ip
./deploy/setup.sh

# Deploy app
./deploy/deploy.sh

# Manual deploy
cd /var/www/${projectName}
git pull
npm install
npm run build
pm2 restart ${projectName}
```

## üîß Configuration Locations

### Environment Variables

**Development:**
```
.env.local                           # Local development (gitignored)
```

**Production:**
- **Vercel**: Dashboard ‚Üí Settings ‚Üí Environment Variables
- **Railway**: Dashboard ‚Üí Variables
- **Render**: Dashboard ‚Üí Environment
- **EC2**: `/var/www/${projectName}/.env`

### OAuth Callbacks

**Development:**
```
http://localhost:3000/api/auth/callback/[provider]
```

**Production:**
- **Vercel**: `https://your-app.vercel.app/api/auth/callback/[provider]`
- **Railway**: `https://your-app.up.railway.app/api/auth/callback/[provider]`
- **Render**: `https://your-app.onrender.com/api/auth/callback/[provider]`
- **EC2**: `https://your-domain.com/api/auth/callback/[provider]`

## üìä Platform Comparison

### Setup Time
- Vercel: **2-3 minutes** ‚ö°
- Railway: **5-10 minutes** ‚ö°
- Render: **5-10 minutes** ‚ö°
- EC2 (automated): **15-30 minutes** üê¢
- EC2 (manual): **1-2 hours** üêå

### Cost (Production)
- Vercel: **$20/month** (Pro)
- Railway: **$5-10/month** (Starter/Developer)
- Render: **$14/month** (Web + DB)
- EC2: **$10-50/month** (t2.small to t2.large)

### Free Tier
- Vercel: ‚úÖ Hobby (limited)
- Railway: ‚úÖ $5 credit/month
- Render: ‚úÖ 750 hours/month
- EC2: ‚úÖ t2.micro (12 months)

### Database Included
- Vercel: ‚ùå (use external)
- Railway: ‚úÖ PostgreSQL, MySQL, MongoDB, Redis
- Render: ‚úÖ PostgreSQL, Redis
- EC2: ‚ö†Ô∏è Self-managed

### Auto-Deploy
- Vercel: ‚úÖ GitHub, GitLab, Bitbucket
- Railway: ‚úÖ GitHub, GitLab
- Render: ‚úÖ GitHub, GitLab
- EC2: ‚ùå Manual (can set up CI/CD)

## üîê Security Checklist

### Before Deployment
- [ ] All secrets in environment variables (not code)
- [ ] `.env.local` in `.gitignore`
- [ ] OAuth callback URLs updated
- [ ] Database connection secured
- [ ] API keys rotated for production
- [ ] Build succeeds locally

### Docker Security
- [ ] Non-root user in Dockerfile
- [ ] Multi-stage build
- [ ] No secrets in image
- [ ] `.dockerignore` configured
- [ ] Health checks enabled

### EC2 Security
- [ ] SSH key secured
- [ ] Firewall configured (ports 22, 80, 443)
- [ ] SSL/TLS enabled (certbot)
- [ ] Nginx security headers
- [ ] PM2 or systemd for process management
- [ ] Regular security updates

## üêõ Common Issues

### Vercel

**Build fails:**
```bash
# Check build command in vercel.json
# Verify all dependencies in package.json
# Check build logs in Vercel dashboard
```

**Environment variables not working:**
```bash
# Ensure variables are set in Vercel dashboard
# Redeploy after adding variables
# Check variable names match exactly
```

### Railway

**Database connection fails:**
```bash
# Check DATABASE_URL is set automatically
# Verify database is running in Railway dashboard
# Check connection string format
```

**Build timeout:**
```bash
# Increase build timeout in railway.json
# Optimize build process
# Check for hanging processes
```

### Render

**502 Bad Gateway:**
```bash
# Check app is listening on PORT env variable
# Verify start command is correct
# Check logs for errors
```

**Slow cold starts:**
```bash
# Upgrade from free tier
# Keep app warm with uptime monitoring
# Optimize startup time
```

### EC2

**Nginx 502 Bad Gateway:**
```bash
# Check app is running: pm2 status
# Verify port in nginx config matches app
# Check nginx error logs: sudo tail -f /var/log/nginx/error.log
```

**SSL certificate fails:**
```bash
# Verify DNS points to EC2 IP
# Check ports 80 and 443 are open
# Run: sudo certbot --nginx -d domain.com
```

**PM2 not starting on boot:**
```bash
# Run: pm2 startup
# Execute the command PM2 outputs
# Run: pm2 save
```

## üìö Documentation Files

### Generated Files
```
README.md                            # Project overview, getting started
SETUP.md                             # Detailed setup for auth, DB, AI
DEPLOYMENT.md                        # Platform-specific deployment guides
.env.example                         # All required environment variables
```

### Key Sections

**README.md:**
- Tech stack overview
- Getting started
- Available scripts
- Deployment links
- Security best practices
- Troubleshooting

**SETUP.md:**
- Prerequisites
- Database setup (PostgreSQL, MongoDB, Supabase)
- Auth setup (NextAuth, Clerk, Supabase)
- AI setup (Anthropic, OpenAI, etc.)
- Environment variables

**DEPLOYMENT.md:**
- Pre-deployment checklist
- Vercel step-by-step guide
- Railway step-by-step guide
- Render step-by-step guide
- EC2 comprehensive guide
- OAuth callback updates

## üéØ Best Practices

### Development
1. Use `.env.local` for local secrets
2. Never commit `.env.local` or `.env`
3. Keep `.env.example` updated
4. Test build locally before deploying
5. Use health check endpoints

### Production
1. Use different secrets than development
2. Enable SSL/TLS (HTTPS)
3. Set up monitoring and logging
4. Configure auto-deploy from main branch
5. Set up staging environment
6. Regular security updates
7. Database backups

### Environment Variables
1. Document all variables in `.env.example`
2. Use descriptive variable names
3. Never hardcode secrets
4. Rotate keys regularly
5. Use secret management in production

## üîó Useful Links

### Platform Documentation
- [Vercel Docs](https://vercel.com/docs)
- [Railway Docs](https://docs.railway.app)
- [Render Docs](https://render.com/docs)
- [AWS EC2 Docs](https://docs.aws.amazon.com/ec2/)

### Tools
- [Let's Encrypt (SSL)](https://letsencrypt.org/)
- [PM2 (Process Manager)](https://pm2.keymetrics.io/)
- [Nginx Docs](https://nginx.org/en/docs/)
- [Docker Docs](https://docs.docker.com/)

### Auth Providers
- [NextAuth.js](https://next-auth.js.org/)
- [Clerk](https://clerk.com/docs)
- [Supabase Auth](https://supabase.com/docs/guides/auth)

### Databases
- [Supabase](https://supabase.com/docs)
- [Railway PostgreSQL](https://docs.railway.app/databases/postgresql)
- [Render PostgreSQL](https://render.com/docs/databases)
- [MongoDB Atlas](https://www.mongodb.com/docs/atlas/)

## üí° Pro Tips

1. **Start with Vercel** for Next.js projects - fastest path to production
2. **Use Railway** if you need a database - easiest full-stack setup
3. **Choose EC2** for enterprise or custom requirements - most control
4. **Enable Docker** for consistent environments across platforms
5. **Set up GitHub Actions** for automated testing and deployment
6. **Use health checks** for monitoring and auto-restart
7. **Keep secrets secure** - never commit, always use env vars
8. **Test locally first** - `npm run build` should succeed
9. **Update OAuth callbacks** immediately after deployment
10. **Monitor logs** regularly for errors and performance issues

## üö® Emergency Procedures

### Rollback Deployment

**Vercel:**
```bash
# In dashboard: Deployments ‚Üí Previous deployment ‚Üí Promote to Production
```

**Railway:**
```bash
# In dashboard: Deployments ‚Üí Previous deployment ‚Üí Redeploy
```

**Render:**
```bash
# In dashboard: Manual Deploy ‚Üí Select previous commit
```

**EC2:**
```bash
cd /var/www/${projectName}
git reset --hard HEAD~1
npm install
npm run build
pm2 restart ${projectName}
```

### Database Issues

**Connection lost:**
1. Check database service status
2. Verify connection string
3. Check firewall rules
4. Restart database service

**Data corruption:**
1. Stop application immediately
2. Restore from latest backup
3. Investigate root cause
4. Update backup procedures

### Security Breach

1. **Rotate all secrets immediately**
2. **Review access logs**
3. **Update all OAuth apps**
4. **Force user re-authentication**
5. **Audit code for vulnerabilities**
6. **Update dependencies**
7. **Document incident**

## üìû Support

### Platform Support
- **Vercel**: [support.vercel.com](https://vercel.com/support)
- **Railway**: [Discord](https://discord.gg/railway)
- **Render**: [support@render.com](mailto:support@render.com)
- **AWS**: [AWS Support](https://aws.amazon.com/support/)

### Community
- **Next.js**: [GitHub Discussions](https://github.com/vercel/next.js/discussions)
- **Express**: [GitHub Issues](https://github.com/expressjs/express/issues)
- **Stack Overflow**: Tag with platform name

---

**Last Updated**: Based on current implementation
**Version**: 1.0
**Status**: Production Ready (with noted gaps)
